!function(){"use strict";var e="undefined"!=typeof window?window:global;if("function"!=typeof e.require){var r={},t={},n=function(e,r){return{}.hasOwnProperty.call(e,r)},a=function(e,r){var t,n,a=[];t=/^\.\.?(\/|$)/.test(r)?[e,r].join("/").split("/"):r.split("/");for(var s=0,i=t.length;i>s;s++)n=t[s],".."===n?a.pop():"."!==n&&""!==n&&a.push(n);return a.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},i=function(r){return function(t){var n=s(r),i=a(n,t);return e.require(i,r)}},o=function(e,r){var n={id:e,exports:{}};return t[e]=n,r(n.exports,i(e),n),n.exports},u=function(e,s){var i=a(e,".");if(null==s&&(s="/"),n(t,i))return t[i].exports;if(n(r,i))return o(i,r[i]);var u=a(i,"./index");if(n(t,u))return t[u].exports;if(n(r,u))return o(u,r[u]);throw new Error('Cannot find module "'+e+'" from "'+s+'"')},c=function(e,t){if("object"==typeof e)for(var a in e)n(e,a)&&(r[a]=e[a]);else r[e]=t},f=function(){var e=[];for(var t in r)n(r,t)&&e.push(t);return e};e.require=u,e.require.define=c,e.require.register=c,e.require.list=f,e.require.brunch=!0}}(),require.register("src/cards",function(e,r,t){var n,a,s,i,o,u,c,f,d;n={FACE_DOWN:0,FACE_UP:1,MATCHED:2,SELECTED:3},a=["apples-and-honey","bath","biking","camping","candy","challah","chanukah","chicken-soup","cruise","deli","dessing-up","dreydel","flowers","hamantashen","hebrew","ice-cream","lifting-weights","menorah","painting","park","pictures","presents","reading","shabbos","shopping","singing","skiing","sleeping","snowman","sukkah","swimming","tzadaka"],s=R.mapIndexed(function(e,r){return{id:e+(1+r%2),image:e,status:n.FACE_DOWN}}),c=R.chain(function(e){return[e,e]}),i=R.compose(s,c),f=function(){return Math.floor(3*Math.random())-1},d=R.sort(f),u=R.compose(d,i),o=R.map(function(e){return{id:e,image:e,status:n.FACE_UP}}),t.exports={CARD_STATES:n,getDeck:u,getCards:o}}),require.register("src/drawing",function(e,r,t){var n,a,s,i,o,u,c,f,d;n=r("./cards").CARD_STATES,s={},s[n.FACE_DOWN]="face-down",s[n.FACE_UP]="face-up",a=function(e,r,t){return"<div id='"+e+"' class='card "+s[t]+" "+r+"'></div>"},u=function(e){return Zepto(a(e.id,e.image,e.status))},o=function(e){return e.appendTo(Zepto("#cards"))},c=R.reduce(function(e,r){var t;return t=R.compose(o,u)(r),R.assoc(r.id,t,e)},{}),i=function(){return Zepto("#game").removeClass(),Zepto("#cards").empty(),Zepto("#message").hide()},f=function(e){return Zepto("#message").show().text(e)},d=function(e){return Zepto("#game").addClass(e)},t.exports={renderDeck:c,clearTable:i,renderMessage:f,setMode:d}}),require.register("src/fsm",function(e,r,t){var n,a;n={},a=function(e,r){var t,s;return s=r[0],t=r[1],e&&console.debug("Enter "+n[s].name.toUpperCase()+" with initial data "+t),s(t).take(1).map(function(r){return function(r){var t,a,i;return i=r[0],t=r[1],e&&console.debug("Exit "+n[s].name.toUpperCase()+' with transition "'+i+'"'),a=n[s].transitions[i],[a,t]}}(this)).flatMap(a.bind(this,e)).toProperty(function(){return[n[s].name,t]})},t.exports={loadState:function(e){return n[e.state]={name:e.name,transitions:e.transitions}},start:function(e,r,t){var n;return null==t&&(t=!1),n=a(t,[e,r]),n.onAny(function(){})}}}),require.register("src/game",function(e,r,t){var n,a,s,i,o,u;n=r("./cards"),s=r("../src/fsm"),o=r("./states/preload"),u=r("./states/select"),i=r("./states/play"),a=r("./states/end"),Zepto(function(){var e,r,t;return FastClick.attach(document.body),s.loadState({name:"Preload",state:o,transitions:{assetsReady:u}}),s.loadState({name:"Select",state:u,transitions:{play:i}}),s.loadState({name:"Play",state:i,transitions:{youWin:a}}),s.loadState({name:"End",state:a,transitions:{startOver:u}}),e=["bath","dressing-up","ice-cream","painting","park","reading"],t=!0,r=s.start(o,e,t)})}),require.register("src/states/end",function(e,r,t){var n;n=r("../drawing"),t.exports=function(e){return n.renderMessage("YOU WIN!"),Kefir.later(2e3,["startOver"]).onValue(function(){return n.clearTable()})}}),require.register("src/states/play",function(e,r,t){var n,a;n=r("../cards"),a=r("../drawing"),t.exports=function(e){var r,t,s,i,o,u,c,f,d,p,l,m,g;return o=n.getDeck(e),a.setMode("play"),r=a.renderDeck(o),d=R.pipe(R.toPairs,R.map(function(e){var r,t;return t=e[0],r=e[1],Kefir.fromEvents(r,"click",R.always(t))})),t=d(r),g=Kefir.merge(t).scan(function(e,r){var t;return 2===e.faceUps.length?{faceUps:[r],valid:!0}:R.contains(r,e.faceUps)?R.merge(e,{valid:!1}):(t=R.append(r,e.faceUps),{faceUps:t,valid:!0})},{faceUps:[],valid:!1}).map(R.prop("valid")),u=Kefir.merge(t).filterBy(g).scan(function(e,r){return 2===e.length?[r]:R.append(r,e)},[]),p=u.filter(R.compose(R.eq(2),R.length)).map(function(e){var r;return r=function(e){return e.replace(/\d/,"")},p=R.compose(R.apply(R.eq),R.map(r))(e),{affectedCards:e,match:p}}),l=p.delay(1500),f=function(e){var r,t;return r=function(e){return{affectedCards:[R.last(e)],status:n.CARD_STATES.FACE_UP}},t=function(e){return{affectedCards:e.affectedCards,status:e.match?n.CARD_STATES.MATCHED:n.CARD_STATES.FACE_DOWN}},Kefir.merge([u.map(r),l.map(t)]).filter(R.compose(R.contains(e.id),R.prop("affectedCards"))).scan(function(e,r){return R.merge(e,{status:r.status})},e)},s=Kefir.merge(R.map(f,o)),m=function(e){return e.status===n.CARD_STATES.FACE_UP?(r[e.id].removeClass("face-down"),r[e.id].addClass("face-up selected")):e.status===n.CARD_STATES.FACE_DOWN?(r[e.id].removeClass("face-up selected"),r[e.id].addClass("face-down")):e.status===n.CARD_STATES.MATCHED?r[e.id].addClass("matched"):void 0},s.onValue(m),i=p.filter(R.prop("match")).scan(function(e,r){var t;return t=r.affectedCards,R.concat(t,e)},[]),c=i.filter(R.compose(R.eq(o.length),R.length)).take(1).delay(3e3).onValue(function(){return s.offValue(m),a.clearTable()}).map(function(e){return["youWin",e]})}}),require.register("src/states/preload",function(e,r,t){var n;n=r("../drawing"),t.exports=function(e){var r,t,a;return n.renderMessage("Loading..."),t=new PxLoader,a=function(e){return"assets/"+e+".jpg"},r=R.forEach(R.compose(t.addImage.bind(t),a)),r(e),t.addImage("assets/grammy.jpg"),t.start(),Kefir.fromCallback(t.addCompletionListener).map(function(){return["assetsReady",e]})}}),require.register("src/states/select",function(e,r,t){var n,a,s=[].indexOf||function(e){for(var r=0,t=this.length;t>r;r++)if(r in this&&this[r]===e)return r;return-1};n=r("../cards"),a=r("../drawing"),t.exports=function(e){var r,t,i,o,u,c,f;return i=n.getCards(e),r=a.renderDeck(i),a.renderMessage("Pick 4 cards to play with:"),a.setMode("select"),u=function(e){var t,n,a,s;for(s=[],n=0,a=e.length;a>n;n++)t=e[n],s.push(r[t].addClass("selected"));return s},c=R.pipe(R.toPairs,R.map(function(e){var r,t;return t=e[0],r=e[1],Kefir.fromEvents(r,"click",R.always(t))})),t=c(r),f=Kefir.merge(t).scan(function(e,r){return s.call(e,r)>=0?e:R.append(r,e)},[]).onValue(u),o=f.skipWhile(R.compose(R.gt(4),R.length)).take(1).delay(1e3).map(function(e){return["play",e]}).onValue(function(){return f.offValue(u),a.clearTable()})}});